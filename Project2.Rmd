---
title: "Project 2"
author: "Młyniec Paweł, Artur Godlewski"
date: "11/01/2021"
output: html_document

---

<style type="text/css">
  body{
  font-size: 16pt;
}
code.r{
  font-size: 14px;
}
pre {
  font-size: 14px
}
</style>

<p>Do zadania 1 przydzielonymi naszemu zespołowi są województwa: swietokrzyskie, zachodnio-pomorskie, podlaskie, mazowieckie, wielkopolskie, warminsko-mazurskie i malopolskie.
Do zadania 1 przydzielonymi naszemu zespołowi są ligi: Primeira Liga (Liga portugalska), Ekstraklasa (Liga polska), Primera Division (Liga hiszpańska) i Premier League (Liga rosyjska).</p>

```{r}
library(ggplot2, scales)
Sys.setenv(LANGUAGE="pl")
x <- Sys.setlocale("LC_TIME", "Polish")
```

<b>Zadanie 1.</b> Korzystajac z danych dostepnych w internecie:

<b>c) W kazdym z poniższych przypadków wskaz ewentualnie, które województwa istotnie sie od siebie róznia
pod katem rozwazanych statystyk.</b>

<b>a) Sprawdz, czy wirus SARS-CoV-2 równomiernie rozprzestrzenił sie na terenie Polski, tzn. czy liczba osób
zarazonych wirusem w poszczególnych województwach jest proporcjonalna do populacji tych województw.</b>

```{r, fig.width=12,fig.height=8}
#zostawiam kod z projektu 1, coś (zwłaszcza jak pisać te ggplot'y) może się przydać
# df_pzu <- read.csv('data/end_of_day_PZU.csv')
# names(df_pzu) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
# df_pzu$date <- as.Date.character(df_pzu$date, format = '%Y%m%d')
# df_pzu$open_ch <- with(df_pzu, c(NA, 100 * diff(open)/open[1:length(open) -1]))
# df_pzu <- df_pzu[with(df_pzu, order(date)), ]
# 
# ggplot(data=df_pzu, aes(x = date, y = open_ch)) +
#   geom_line(color = "blue", size = 1) +
#   labs(title = "Zmiana kursu otwarcia PZU", x = "Data", y = "Zmiana[%]") +
#   scale_x_date(date_breaks = "months" , date_labels = "%b-%Y") +
#   theme(
#     plot.title = element_text(size = 20, face = "bold", hjust = 0.5,margin = margin(t = 40, r = 0, b = 20, l = 0)),
#     axis.title=element_text(size=18),
#     axis.title.y=element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
#     axis.title.x=element_text(margin = margin(t = 20, r = 0, b = 40, l = 0)),
#     axis.text=element_text(size=16),
#     axis.text.x=element_text(angle = 90)
#   )

```

```{r, fig.width=12,fig.height=8}
#zostawiam kod z projektu 1, coś (zwłaszcza jak pisać te ggplot'y) może się przydać
# df_lccorp <- read.csv('data/end_of_day_LCCORP.csv')
# names(df_lccorp) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
# df_lccorp$date <- as.Date.character(df_lccorp$date, format = '%Y%m%d')
# df_lccorp$open_ch <- with(df_lccorp, c(NA, 100 * diff(open)/open[1:length(open) -1]))
# df_lccorp <- df_lccorp[with(df_lccorp, order(date)), ]
# 
# ggplot(data=df_lccorp, aes(x = date, y = open_ch)) +
#   geom_line(color = "blue", size = 1) +
#   labs(title = "Zmiana kursu otwarcia LCCORP (DVL)", x = "Data", y = "Zmiana[%]") +
#   scale_x_date(date_breaks = "months" , date_labels = "%b-%Y") +
#   theme(
#     plot.title = element_text(size = 20, face = "bold", hjust = 0.5,margin = margin(t = 40, r = 0, b = 20, l = 0)),
#     axis.title=element_text(size=18),
#     axis.title.y=element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
#     axis.title.x=element_text(margin = margin(t = 20, r = 0, b = 40, l = 0)),
#     axis.text=element_text(size=16),
#     axis.text.x=element_text(angle = 90)
#   )
```

<b>b) Sprawdz, czy skutecznosc leczenia osób zarazonych wirusem SARS-CoV-2 jest taka sama na terenie całej
Polski, tzn. czy liczba przypadków smiertelnych jest proporcjonalna do liczby osób zarazonych przy podziale
na województwa.</b>
```{r, fig.width=10,fig.height=10, warning=FALSE}
# #zostawiam kod z projektu 1, coś (zwłaszcza jak pisać te ggplot'y) może się przydać
# ggplot(data=df_pzu, aes(x = open_ch)) +
#   geom_histogram(aes(y = stat(count / sum(count))), binwidth = 1, color = "black", fill = "green") +
#   labs(title = "Histogram zmian kursu PZU", x = "Zmiana[%]", y = "Częstość występowania") +
#   scale_x_continuous(breaks = seq(-20, 15, by = 5)) +
#   theme(
#     plot.title = element_text(size = 20, face = "bold", hjust = 0.5,margin = margin(t = 40, r = 0, b = 20, l = 0)),
#     axis.title=element_text(size=18),
#     axis.title.y=element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
#     axis.title.x=element_text(margin = margin(t = 20, r = 0, b = 40, l = 0)),
#     axis.text=element_text(size=16)
#   )
# 
# ggplot(data=df_pzu, aes(y = open_ch)) +
#   geom_boxplot(color = "black", fill = "green", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title = "Wykres pudełkowy zmian kursu PZU", x = "", y = "Zmiana[%]") +
#   scale_y_continuous(breaks = seq(-20, 15, by = 5)) +
#   theme(
#     plot.title = element_text(size = 20, face = "bold", hjust = 0.5,margin = margin(t = 40, r = 0, b = 20, l = 0)),
#     axis.title=element_text(size=18),
#     axis.title.y=element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
#     axis.title.x=element_text(margin = margin(t = 20, r = 0, b = 40, l = 0)),
#     axis.text=element_text(size=16)
#   )
```

```{r, fig.width=10,fig.height=10, warning=FALSE}
#zostawiam kod z projektu 1, coś (zwłaszcza jak pisać te ggplot'y) może się przydać
# ggplot(data=df_lccorp, aes(x = open_ch)) +
#   geom_histogram(aes(y = stat(count / sum(count))), binwidth = 1, color = "black", fill = "green") +
#   labs(title = "Histogram zmian kursu LCCORP (DVL)", x = "Zmiana[%]", y = "Częstość występowania") +
#   scale_x_continuous(breaks = seq(-20, 15, by = 5)) +
#   theme(
#     plot.title = element_text(size = 20, face = "bold", hjust = 0.5,margin = margin(t = 40, r = 0, b = 20, l = 0)),
#     axis.title=element_text(size=18),
#     axis.title.y=element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
#     axis.title.x=element_text(margin = margin(t = 20, r = 0, b = 40, l = 0)),
#     axis.text=element_text(size=16)
#   )
# 
# ggplot(data=df_lccorp, aes(y = open_ch)) +
#   geom_boxplot(color = "black", fill = "green", outlier.colour="red", outlier.shape=8, outlier.size=4) +
#   labs(title = "Wykres pudełkowy zmian kursu LCCORP (DVL)", x = "", y = "Zmiana[%]") +
#   scale_y_continuous(breaks = seq(-20, 15, by = 5)) +
#   theme(
#     plot.title = element_text(size = 20, face = "bold", hjust = 0.5,margin = margin(t = 40, r = 0, b = 20, l = 0)),
#     axis.title=element_text(size=18),
#     axis.title.y=element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)),
#     axis.title.x=element_text(margin = margin(t = 20, r = 0, b = 40, l = 0)),
#     axis.text=element_text(size=16)
#   )
```

<b>2. Sprawdz teze mówiaca o tym, ze tzw. atut własnego boiska w ligowym meczu piłkarskim
nie zalezy od kraju, w którym tocza sie dane rozgrywki ligowe. W tym celu, zweryfikuj hipoteze o niezaleznosci
wyniku meczu, rozumianego jako zwyciestwo, porazke lub remis gospodarzy, od kraju rozgrywek.

W ramach rozwiazania zadania zaimplementuj odpowiednie dla testu niezaleznosci wyrazenia, na podstawie
których obliczane sa: statystyka testowa, wartosc krytyczna oraz p-wartosc.

Przeprowadz wnioskowanie porównujac wartosc otrzymanej statystyki testowej z wartoscia krytyczna, przy poziomie istotnosci 0, 05.
Czy obliczona p-wartosc potwierdza wynik wnioskowania?
Sprawdz uzyskane wyniki wykorzystujac funkcje chisq.test.</b>

Hipoteza zerowa $$H0:\ _"Atut\ własnego\ boiska\ jest\ niezależny\ od\ ligi\ rozgrywkowej."$$
Hipoteza alternatywna $$H1:\ _"Atut\ własnego\ boiska\ jest\ zależny\ od\ ligi\ rozgrywkowej."$$

Hipoteza będzie sprawdzana testem $\chi^{2}$.

Dane zostały zebrane z strony https://pl.fcstats.com.

Wczytanie danych:

```{r}
fc_data <- data.frame(Name = c("Primeria_Liga", "Ekstrakalasa", "Primera_Division", "Premier_League"),
                 Win= c(104, 108,194,109),
                 Draw=c(68, 65, 95,69),
                 Lost=c(68,67,91,62))
fc_data
```

Wykresy obrazujące wygrane, remisy i porażki gospodarzy w poszczególnych ligach:

```{r, fig.width=10,fig.height=10, warning=FALSE}
library(ggplot2)

ggplot(data=fc_data, aes(x=Name,y= Win)) +
  geom_bar(stat = "identity") +
  ggtitle("Number of hosts winning matches in leagues") +
  xlab("Legue name") +
  ylab("Host winning matches") +
  ylim(0, 200)

ggplot(data=fc_data, aes(x=Name,y= Draw)) +
  geom_bar(stat = "identity") +
  ggtitle("Number of draw matches in leagues") +
  xlab("Legue name") +
  ylab("Draw matches")+
  ylim(0, 200)

ggplot(data=fc_data, aes(x=Name,y= Lost)) +
  geom_bar(stat = "identity") +
  ggtitle("Number of hosts lost matches in leagues") +
  xlab("Legue name") +
  ylab("Lost matches") +
  ylim(0, 200)
  
```

Wartość krytyczna $c$ będzie wyznaczana następującym wzorem:
$$ c = F^{-1}_{\chi^{2}_{(n-1)(m-1)}}(1-\alpha)$$
Gdzie $n$, $m$ oznacza liczbę stopni swobody kolejno w wierszach i kolumnach.
Poziom istotności wynosi: $\alpha = 0.05$

Dla danych danych liczba stopni swobody wyniosi 6:
```{r}
chi_freedom_degrees <- (dim(fc_data[,2:4])[1] - 1)*(dim(fc_data[,2:4])[2] - 1)
chi_freedom_degrees
```

Wartość krytyczna natomiast:
```{r}
alpha <- 0.05
c <- qchisq(p=alpha, df=chi_freedom_degrees, lower.tail=FALSE)
```
$$ c = F^{-1}_{\chi^{2}_{6}}(1-0,05) = `r c` $$
Następnie obliczam wartość $\chi^{2}$:
```{r}
col_sum <- matrix(colSums(fc_data[,2:4]))
row_sum <- matrix(rowSums(fc_data[,2:4]))

stat <- row_sum %*% t(col_sum)/sum(row_sum)

chisq <- sum((stat - fc_data[,2:4]) * (stat - fc_data[,2:4])/stat)
```
Wartość $\chi^{2}$ jest równa:
$$\chi^{2} = `r chisq`$$

Jest ona mniejsza niż wartość krytyczna, nie można więc odrzucić hipotezy zerowej.

Wyliczam p-wartość:
```{r}
p_val <- pchisq(chisq, df=chi_freedom_degrees, lower.tail=FALSE)
```

P-wartość wynosi:
$$p = `r p_val`$$

Jest ona większa niż poziom istotności $\alpha = 0.05$. Potwierdza to, że nie można odrzucić hipotezy zerowej.

Uzyskane wyniki zostają sprawdzone z funkcją $chisq.test$.
```{r}
chisq_test <- chisq.test(fc_data[2:4])
chisq_test
```

Takie same wyniki potwierdzają poprawność obliczeń.
